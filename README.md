![](https://qtech-russia.ru/image/cache/catalog/image/catalog/logo/qtech-logo.webp)

# Подготовка Windows

Для запуска на Windows требуется:

1. Установить Python3 c официального сайта версией не ниже, чем **3.11**:

https://www.python.org/downloads/

### Во время установки Python на первом окне поставить галочку напротив "Добавить в PATH"!

2. Установить Git Bash c официального сайта:

https://git-scm.com/downloads

3. Запустить Git Bash и установить директорию программы с репозитория GitHub:
```
git clone https://github.com/infestedmind/update_many_4530.git
```
4. Проверить прописан ли Python в PATH (видит ли его Git Bash):
```
python --version
```
или
```
python3 --version
```
### В случае, если версия Python не будет выведена в cli, то можно попробовать заново открыть Git Bash или воспользоваться инструкциями в следующей статье:

https://sky.pro/wiki/python/reshenie-problemy-zapuska-python-v-git-bash-na-windows/

5. Запустить виртуальную среду:
```
source venv/bin/activate
```
6. Установить требуемые модули из файла requirements.txt:
```
pip install -r requirements.txt
```

# Подготовка Ubuntu

1. Установить Python3:
```
apt install python3-pip
```
2. Запустить виртуальную среду:
```
source venv/bin/activate
```
3. Установить требуемые модули из файла requirements.txt:
```
pip install -r requirements.txt
```

# Конфигурирование файла config.txt

Для запуска важно корректно заполнить поля внутри файла config.txt, айпи адреса MASTER коммутаторов записываются в самом конце, разделённые друг от друга точками (.)
Пример:
```
###TFTP###
tftp_server_ip: 10.8.8.9
filename: QSW-4530-X_8.2.3.254_nos.img
###SWITCHES###
login: admin
password: admin
.
10.45.96.1
.
10.45.30.2
.
10.45.30.8
```
C пояснениями:
```
###TFTP###
tftp_server_ip: 10.8.8.9 <-- IP-адрес локального tftp-сервера
filename: QSW-4530-X_8.2.3.254_nos.img <-- Название файла с ПО
###SWITCHES###
login: admin <-- Логин для доступа по ssh к комутатору
password: admin <-- Пароль для доступа по ssh к комутатору
.
10.45.96.1 <-- IP-адрес управления коммутатора
.
10.45.30.2 <-- IP-адрес управления коммутатора
.
10.45.30.8 <-- IP-адрес управления коммутатора
```
# Запуск

Запуск программы осуществляется с помощью Python3
```
python3 main.py
```
или
```
python main.py
```
# Принцип работы

1. Программа проверяет доступность коммутатора по ip-адресу (сверху вниз по списку).
2. Если пинг успешный, то инициируется ssh сессия.
3. Если сессия установлена, то проверяется доступность консоли
4. Если консоль доступна, то отправляется команда "copy tftp://... nos.img" для обновления MASTER-коммутатора.
5. После того, как завершается обновление MASTER-коммутатора, запрашивается show unit, по выводу определяется общее количество юнитов и их роли. 
6. Запускается обновление юнитов, ACTIVE MASTER-коммутатор на этом этапе пропускается.
7. После обновления юнитов пользователю выводится в консоль сообщение: "Нужно ли проводить перезагрузку (Y/N)".
8. Перезагрузка выполнена/отменена, после этого работа программы завершается.